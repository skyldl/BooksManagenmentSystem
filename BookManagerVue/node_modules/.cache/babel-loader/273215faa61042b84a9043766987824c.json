{"remainingRequest":"D:\\Work\\WorkSpace\\GitWorkSpace\\shop-pjt\\BookManager\\BookManagerVue\\node_modules\\babel-loader\\lib\\index.js!D:\\Work\\WorkSpace\\GitWorkSpace\\shop-pjt\\BookManager\\BookManagerVue\\src\\store\\modules\\user.js","dependencies":[{"path":"D:\\Work\\WorkSpace\\GitWorkSpace\\shop-pjt\\BookManager\\BookManagerVue\\src\\store\\modules\\user.js","mtime":1676974401542},{"path":"D:\\Work\\WorkSpace\\GitWorkSpace\\shop-pjt\\BookManager\\BookManagerVue\\babel.config.js","mtime":1676974401511},{"path":"D:\\Work\\WorkSpace\\GitWorkSpace\\shop-pjt\\BookManager\\BookManagerVue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1676988577868},{"path":"D:\\Work\\WorkSpace\\GitWorkSpace\\shop-pjt\\BookManager\\BookManagerVue\\node_modules\\babel-loader\\lib\\index.js","mtime":1676988577850}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZS5qcyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmcuanMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5zdHJpbmcudHJpbS5qcyI7CmltcG9ydCB7IGxvZ2luIGFzIF9sb2dpbiwgbG9nb3V0IGFzIF9sb2dvdXQsIGdldEluZm8gYXMgX2dldEluZm8gfSBmcm9tICdAL2FwaS91c2VyJzsKaW1wb3J0IHsgZ2V0VG9rZW4sIHNldFRva2VuLCByZW1vdmVUb2tlbiB9IGZyb20gJ0AvdXRpbHMvYXV0aCc7CmltcG9ydCB7IHJlc2V0Um91dGVyIH0gZnJvbSAnQC9yb3V0ZXInOwp2YXIgZ2V0RGVmYXVsdFN0YXRlID0gZnVuY3Rpb24gZ2V0RGVmYXVsdFN0YXRlKCkgewogIHJldHVybiB7CiAgICB0b2tlbjogZ2V0VG9rZW4oKSwKICAgIGlkOiAwLAogICAgbmFtZTogJycsCiAgICBhdmF0YXI6ICcnLAogICAgcm9sZXM6IFtdCiAgfTsKfTsKdmFyIHN0YXRlID0gZ2V0RGVmYXVsdFN0YXRlKCk7CnZhciBtdXRhdGlvbnMgPSB7CiAgUkVTRVRfU1RBVEU6IGZ1bmN0aW9uIFJFU0VUX1NUQVRFKHN0YXRlKSB7CiAgICBPYmplY3QuYXNzaWduKHN0YXRlLCBnZXREZWZhdWx0U3RhdGUoKSk7CiAgfSwKICBTRVRfVE9LRU46IGZ1bmN0aW9uIFNFVF9UT0tFTihzdGF0ZSwgdG9rZW4pIHsKICAgIHN0YXRlLnRva2VuID0gdG9rZW47CiAgfSwKICBTRVRfSUQ6IGZ1bmN0aW9uIFNFVF9JRChzdGF0ZSwgaWQpIHsKICAgIHN0YXRlLmlkID0gaWQ7CiAgfSwKICBTRVRfTkFNRTogZnVuY3Rpb24gU0VUX05BTUUoc3RhdGUsIG5hbWUpIHsKICAgIHN0YXRlLm5hbWUgPSBuYW1lOwogIH0sCiAgU0VUX0FWQVRBUjogZnVuY3Rpb24gU0VUX0FWQVRBUihzdGF0ZSwgYXZhdGFyKSB7CiAgICBzdGF0ZS5hdmF0YXIgPSBhdmF0YXI7CiAgfSwKICBTRVRfUk9MRVM6IGZ1bmN0aW9uIFNFVF9ST0xFUyhzdGF0ZSwgcm9sZXMpIHsKICAgIHN0YXRlLnJvbGVzID0gcm9sZXM7CiAgfQp9Owp2YXIgYWN0aW9ucyA9IHsKICAvLyB1c2VyIGxvZ2luCiAgbG9naW46IGZ1bmN0aW9uIGxvZ2luKF9yZWYsIHVzZXJJbmZvKSB7CiAgICB2YXIgY29tbWl0ID0gX3JlZi5jb21taXQ7CiAgICB2YXIgdXNlcm5hbWUgPSB1c2VySW5mby51c2VybmFtZSwKICAgICAgcGFzc3dvcmQgPSB1c2VySW5mby5wYXNzd29yZCwKICAgICAgaXNhZG1pbiA9IHVzZXJJbmZvLmlzYWRtaW47CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICBfbG9naW4oewogICAgICAgIHVzZXJuYW1lOiB1c2VybmFtZS50cmltKCksCiAgICAgICAgdXNlcnBhc3N3b3JkOiBwYXNzd29yZCwKICAgICAgICBpc2FkbWluOiBpc2FkbWluCiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7CiAgICAgICAgdmFyIHN0YXR1cyA9IHJlc3BvbnNlLnN0YXR1cywKICAgICAgICAgIG1lc3NhZ2UgPSByZXNwb25zZS5tZXNzYWdlLAogICAgICAgICAgZGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgaWYgKHN0YXR1cyAhPT0gMjAwKSB7CiAgICAgICAgICByZWplY3QobWVzc2FnZSk7CiAgICAgICAgfQogICAgICAgIGNvbW1pdCgnU0VUX1RPS0VOJywgZGF0YS50b2tlbik7CiAgICAgICAgc2V0VG9rZW4oZGF0YS50b2tlbik7CiAgICAgICAgcmVzb2x2ZSgpOwogICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICByZWplY3QoZXJyb3IpOwogICAgICB9KTsKICAgIH0pOwogIH0sCiAgLy8gZ2V0IHVzZXIgaW5mbwogIGdldEluZm86IGZ1bmN0aW9uIGdldEluZm8oX3JlZjIpIHsKICAgIHZhciBjb21taXQgPSBfcmVmMi5jb21taXQsCiAgICAgIHN0YXRlID0gX3JlZjIuc3RhdGU7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUsIHJlamVjdCkgewogICAgICBfZ2V0SW5mbyhzdGF0ZS50b2tlbikudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHsKICAgICAgICB2YXIgZGF0YSA9IHJlc3BvbnNlLmRhdGE7CiAgICAgICAgaWYgKCFkYXRhKSB7CiAgICAgICAgICByZWplY3QoJ+mqjOivgeWksei0pe+8jOivt+mHjeaWsOeZu+W9lScpOwogICAgICAgIH0KICAgICAgICBpZiAoZGF0YS5pc2FkbWluID09PSAxKSBkYXRhWydyb2xlcyddID0gWydhZG1pbiddO2Vsc2UgZGF0YVsncm9sZXMnXSA9IFsncmVhZGVyJ107CiAgICAgICAgZGF0YVsnYXZhdGFyJ10gPSAnaHR0cDovL3dhbmdwZW5nLWltZ3N1Ym1pdC5vc3MtY24taGFuZ3pob3UuYWxpeXVuY3MuY29tL2ltZy8yMDIxMTIyNTE1MTc4NjkuanBnJzsKICAgICAgICB2YXIgdXNlcmlkID0gZGF0YS51c2VyaWQsCiAgICAgICAgICByb2xlcyA9IGRhdGEucm9sZXMsCiAgICAgICAgICB1c2VybmFtZSA9IGRhdGEudXNlcm5hbWUsCiAgICAgICAgICBhdmF0YXIgPSBkYXRhLmF2YXRhcjsKCiAgICAgICAgLy8gcm9sZXMgbXVzdCBiZSBhIG5vbi1lbXB0eSBhcnJheQogICAgICAgIGlmICghcm9sZXMgfHwgcm9sZXMubGVuZ3RoIDw9IDApIHsKICAgICAgICAgIHJlamVjdCgnZ2V0SW5mbzogcm9sZXMg5b+F6aG75piv6Z2e56m65pWw57uEIScpOwogICAgICAgIH0KICAgICAgICBjb21taXQoJ1NFVF9JRCcsIHVzZXJpZCk7CiAgICAgICAgY29tbWl0KCdTRVRfUk9MRVMnLCByb2xlcyk7CiAgICAgICAgY29tbWl0KCdTRVRfTkFNRScsIHVzZXJuYW1lKTsKICAgICAgICBjb21taXQoJ1NFVF9BVkFUQVInLCBhdmF0YXIpOwogICAgICAgIHJlc29sdmUoZGF0YSk7CiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgIHJlamVjdChlcnJvcik7CiAgICAgIH0pOwogICAgfSk7CiAgfSwKICAvLyB1c2VyIGxvZ291dAogIGxvZ291dDogZnVuY3Rpb24gbG9nb3V0KF9yZWYzKSB7CiAgICB2YXIgY29tbWl0ID0gX3JlZjMuY29tbWl0LAogICAgICBzdGF0ZSA9IF9yZWYzLnN0YXRlOwogICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHsKICAgICAgX2xvZ291dChzdGF0ZS50b2tlbikudGhlbihmdW5jdGlvbiAoKSB7CiAgICAgICAgcmVtb3ZlVG9rZW4oKTsgLy8gbXVzdCByZW1vdmUgIHRva2VuICBmaXJzdAogICAgICAgIHJlc2V0Um91dGVyKCk7CiAgICAgICAgY29tbWl0KCdSRVNFVF9TVEFURScpOwogICAgICAgIHJlc29sdmUoKTsKICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgcmVqZWN0KGVycm9yKTsKICAgICAgfSk7CiAgICB9KTsKICB9LAogIC8vIHJlbW92ZSB0b2tlbgogIHJlc2V0VG9rZW46IGZ1bmN0aW9uIHJlc2V0VG9rZW4oX3JlZjQpIHsKICAgIHZhciBjb21taXQgPSBfcmVmNC5jb21taXQ7CiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgcmVtb3ZlVG9rZW4oKTsgLy8gbXVzdCByZW1vdmUgIHRva2VuICBmaXJzdAogICAgICBjb21taXQoJ1JFU0VUX1NUQVRFJyk7CiAgICAgIHJlc29sdmUoKTsKICAgIH0pOwogIH0KfTsKZXhwb3J0IGRlZmF1bHQgewogIG5hbWVzcGFjZWQ6IHRydWUsCiAgc3RhdGU6IHN0YXRlLAogIG11dGF0aW9uczogbXV0YXRpb25zLAogIGFjdGlvbnM6IGFjdGlvbnMKfTs="},{"version":3,"names":["login","logout","getInfo","getToken","setToken","removeToken","resetRouter","getDefaultState","token","id","name","avatar","roles","state","mutations","RESET_STATE","Object","assign","SET_TOKEN","SET_ID","SET_NAME","SET_AVATAR","SET_ROLES","actions","_ref","userInfo","commit","username","password","isadmin","Promise","resolve","reject","trim","userpassword","then","response","status","message","data","catch","error","_ref2","userid","length","_ref3","resetToken","_ref4","namespaced"],"sources":["D:/Work/WorkSpace/GitWorkSpace/shop-pjt/BookManager/BookManagerVue/src/store/modules/user.js"],"sourcesContent":["import { login, logout, getInfo } from '@/api/user'\r\nimport { getToken, setToken, removeToken } from '@/utils/auth'\r\nimport { resetRouter } from '@/router'\r\n\r\nconst getDefaultState = () => {\r\n  return {\r\n    token: getToken(),\r\n    id: 0,\r\n    name: '',\r\n    avatar: '',\r\n    roles: []\r\n  }\r\n}\r\n\r\nconst state = getDefaultState()\r\n\r\nconst mutations = {\r\n  RESET_STATE: (state) => {\r\n    Object.assign(state, getDefaultState())\r\n  },\r\n  SET_TOKEN: (state, token) => {\r\n    state.token = token\r\n  },\r\n  SET_ID: (state, id) => {\r\n    state.id = id\r\n  },\r\n  SET_NAME: (state, name) => {\r\n    state.name = name\r\n  },\r\n  SET_AVATAR: (state, avatar) => {\r\n    state.avatar = avatar\r\n  },\r\n  SET_ROLES: (state, roles) => {\r\n    state.roles = roles\r\n  }\r\n}\r\n\r\nconst actions = {\r\n  // user login\r\n  login({ commit }, userInfo) {\r\n    const { username, password, isadmin } = userInfo\r\n    return new Promise((resolve, reject) => {\r\n      login({ username: username.trim(), userpassword: password, isadmin: isadmin }).then(response => {\r\n        const { status, message, data } = response\r\n        \r\n        if(status !== 200) {\r\n          reject(message)\r\n        }\r\n\r\n        commit('SET_TOKEN', data.token)\r\n        setToken(data.token)\r\n        resolve()\r\n      }).catch(error => {\r\n        reject(error)\r\n      })\r\n    })\r\n  },\r\n\r\n  // get user info\r\n  getInfo({ commit, state }) {\r\n    return new Promise((resolve, reject) => {\r\n      getInfo(state.token).then(response => {\r\n        const { data } = response\r\n\r\n        if (!data) {\r\n          reject('验证失败，请重新登录')\r\n        }\r\n\r\n        if (data.isadmin === 1) data['roles'] = ['admin']\r\n        else data['roles'] = ['reader']\r\n\r\n        data['avatar'] = 'http://wangpeng-imgsubmit.oss-cn-hangzhou.aliyuncs.com/img/202112251517869.jpg'\r\n\r\n        const { userid, roles, username, avatar } = data\r\n\r\n        // roles must be a non-empty array\r\n        if (!roles || roles.length <= 0) {\r\n          reject('getInfo: roles 必须是非空数组!')\r\n        }\r\n\r\n        commit('SET_ID', userid)\r\n        commit('SET_ROLES', roles)\r\n        commit('SET_NAME', username)\r\n        commit('SET_AVATAR', avatar)\r\n        resolve(data)\r\n      }).catch(error => {\r\n        reject(error)\r\n      })\r\n    })\r\n  },\r\n\r\n  // user logout\r\n  logout({ commit, state }) {\r\n    return new Promise((resolve, reject) => {\r\n      logout(state.token).then(() => {\r\n        removeToken() // must remove  token  first\r\n        resetRouter()\r\n        commit('RESET_STATE')\r\n        resolve()\r\n      }).catch(error => {\r\n        reject(error)\r\n      })\r\n    })\r\n  },\r\n\r\n  // remove token\r\n  resetToken({ commit }) {\r\n    return new Promise(resolve => {\r\n      removeToken() // must remove  token  first\r\n      commit('RESET_STATE')\r\n      resolve()\r\n    })\r\n  }\r\n}\r\n\r\nexport default {\r\n  namespaced: true,\r\n  state,\r\n  mutations,\r\n  actions\r\n}\r\n\r\n"],"mappings":"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"}]}